#!/bin/zsh

#  zmodload zsh/zprof

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# disable traps until we define them later
TRAPUSR1(){ echo "USR1 called before init!" }
TRAPUSR2(){ echo "USR2 called before init!" }

export ZDOTDIR=~/.zsh.d
mkdir -p $ZDOTDIR

source $ZDOTDIR/modules/zplug.zsh

zstyle :compinstall filename '~/.zshrc'
skip_global_compinit=1
fpath=($ZDOTDIR/completers $fpath)


# autoload -Uz compinit  && compinit -d $ZDOTDIR/.zcompdump

# # On slow systems, checking the cached .zcompdump file to see if it must be 
# # regenerated adds a noticable delay to zsh startup.  This little hack restricts 
# # it to once a day.  It should be pasted into your own completion file.
# #
# # The globbing is a little complicated here:
# # - '#q' is an explicit glob qualifier that makes globbing work within zsh's [[ ]] construct.
# # - 'N' makes the glob pattern evaluate to nothing when it doesn't match (rather than throw a globbing error)
# # - '.' matches "regular files"
# # - 'mh+24' matches files (or directories or whatever) that are older than 24 hours.
autoload -Uz compinit 
if [[ -n ${ZDOTDIR}/.zcompdump(#qN.mh+24) ]]; then
	compinit -C;
else
	compinit -C;
fi;


echo -n > $ZDOTDIR/startup.log
setopt function_argzero
unsetopt MULTIBYTE
source $ZDOTDIR/modules/autoloads.zsh
source $ZDOTDIR/modules/options.zsh
source $ZDOTDIR/modules/env.zsh
if [[ -f $ZDOTDIR/local/early.zsh ]]; then
  source $ZDOTDIR/local/early.zsh
fi
source $ZDOTDIR/modules/fasd.zsh
source $ZDOTDIR/modules/syntax_highlighting.zsh
source $ZDOTDIR/modules/auto_fu.zsh
source $ZDOTDIR/modules/keys.zsh
source $ZDOTDIR/modules/aliases.zsh
source $ZDOTDIR/modules/vim.zsh
source $ZDOTDIR/modules/history_search.zsh
# source $ZDOTDIR/modules/path_compressor.zsh
source $ZDOTDIR/modules/smart_completion.zsh
source $ZDOTDIR/modules/intel.zsh
source $ZDOTDIR/modules/zstyle.zsh
# source $ZDOTDIR/modules/vcs.zsh
# source $ZDOTDIR/modules/prompt.zsh
source $ZDOTDIR/modules/g.zsh
source $ZDOTDIR/modules/parser.zsh
# source $ZDOTDIR/modules/title.zsh
# source $ZDOTDIR/modules/chpwd.zsh
source $ZDOTDIR/modules/bindings.zsh
source $ZDOTDIR/modules/functions.zsh

# and source host specific files
for file in $ZDOTDIR/local/*.zsh(nN); do
  if [[ ${file:t:r} != "early" ]]; then
      source $file
  fi
done



source ~/env.sh
source ~/personal.zsh

#  zprof
